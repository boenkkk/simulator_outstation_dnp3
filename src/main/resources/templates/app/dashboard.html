<div th:fragment="content" xmlns:th="http://www.w3.org/1999/xhtml">
    <style>
        .custom-button{
            width: 150px;
            height: 70px;
        }
        .fixed-wh-5em{
            width: 5em;
            height: 5em;
        }
    </style>

    <div class="main-content">
        <div class="row">
            <div class="local-remote group-border col-md-4">
                <h5>Local / Remote</h5>
                <div class="row justify-content-center">
                    <button id="btn-local-remote" class="custom-button btn btn-danger" onclick="">LOCAL</button>
                </div>

                <div class="row justify-content-center">
                    <div class="control-knob dark">
                        <input type="checkbox" id="checkbox-local-remote">
                        <div class="control-position on">
                            <span>LOCAL</span>
                        </div>
                        <div class="control-position off">
                            <span>REMOTE</span>
                        </div>
                        <div class="knob">
                            <div class="knob-center"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cb-open-close group-border col-md-4">
                <h5>CB Open / Close</h5>
                <div class="row justify-content-center">
                    <button id="btn-cb-open" class="custom-button btn btn-secondary">CLOSE</button>
                    <button id="btn-cb-close" class="custom-button btn btn-danger">OPEN</button>
                </div>
                <div class="row justify-content-center">
                    <button id="cb-open-close-btn-close" class="btn btn-success rounded-circle fixed-wh-5em">Close</button>
                    <button id="cb-open-close-btn-open" class="btn btn-danger rounded-circle fixed-wh-5em">Open</button>
                </div>
            </div>

            <div class="tap-changer group-border col-md-4">
                <h5>Tap Changerr</h5>
                <div class="number-adjust-container" style="text-align: center; margin: 20px;">
                    <div style="display: inline-block; border: 1px solid #ccc; padding: 10px; border-radius: 8px;">
                        <!-- Display the number -->
                        <div id="number-display" style="font-size: 36px; font-weight: bold; margin-bottom: 10px;">0</div>

                        <div class="">
                            <button id="tap-changer-decrease" class="adjust-button btn btn-danger">Lower</button>
                            <button id="tap-changer-increase" class="adjust-button btn btn-success">Raise</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(function () {
            // Determine the base URL dynamically
            let baseURL = `${window.location.protocol}//${window.location.hostname}`;
            let socketPort = 47772;
            let socketEndpoint = `${baseURL}:${socketPort}`;

            // start local-remote
            let socketLocalRemote = io(socketEndpoint + "/local-remote");
            let valueLocalRemote;

            socketLocalRemote.on("connect", function () {
                socketLocalRemote.emit("get-data");
            });

            socketLocalRemote.on("disconnect", function () {
            });

            socketLocalRemote.on("listen", function (data) {
                if (data) {
                    valueLocalRemote = data;
                    $("#btn-local-remote").text("REMOTE");
                    $("#btn-local-remote").removeClass("btn-danger");
                    $("#btn-local-remote").addClass("btn-success");
                    $("#checkbox-local-remote").attr("checked", true);

                    disableAllButton(true);
                } else {
                    valueLocalRemote = data;
                    $("#btn-local-remote").text("LOCAL");
                    $("#btn-local-remote").removeClass("btn-success");
                    $("#btn-local-remote").addClass("btn-danger");
                    $("#checkbox-local-remote").attr("checked", false);

                    disableAllButton(false);
                }
            });

            socketLocalRemote.on("connect_error", function (error) {
            });

            $("#checkbox-local-remote").on("click", function () {
                if (valueLocalRemote) {
                    $("#btn-local-remote").text("LOCAL");
                    $("#btn-local-remote").removeClass("btn-success");
                    $("#btn-local-remote").addClass("btn-danger");

                    socketLocalRemote.emit("update-data", false);
                    disableAllButton(false);
                } else {
                    $("#btn-local-remote").text("REMOTE");
                    $("#btn-local-remote").removeClass("btn-danger");
                    $("#btn-local-remote").addClass("btn-success");

                    socketLocalRemote.emit("update-data", true);
                    disableAllButton(true);
                }
            });
            // end local-remote

            // start cb open close
            let socketCBOpenClose = io(socketEndpoint + "/cb-open-close");
            let valueCBOpenClose;

            socketCBOpenClose.on("connect", function () {
                socketCBOpenClose.emit("get-data");
            });

            socketCBOpenClose.on("disconnect", function () {
            });

            socketCBOpenClose.on("listen", function (data) {
                if (data){
                    valueCBOpenClose = data;
                    $("#btn-cb-open").removeClass("btn-secondary");
                    $("#btn-cb-open").addClass("btn-success");
                    $("#btn-cb-close").removeClass("btn-danger");
                    $("#btn-cb-close").addClass("btn-secondary");
                } else {
                    valueCBOpenClose = data;
                    $("#btn-cb-open").removeClass("btn-success");
                    $("#btn-cb-open").addClass("btn-secondary");
                    $("#btn-cb-close").removeClass("btn-secondary");
                    $("#btn-cb-close").addClass("btn-danger");
                }
            });

            socketCBOpenClose.on("connect_error", function (error) {
            });

            $("#cb-open-close-btn-close").on("click", function () {
                $("#btn-cb-open").removeClass("btn-success");
                $("#btn-cb-open").addClass("btn-secondary");
                $("#btn-cb-close").removeClass("btn-secondary");
                $("#btn-cb-close").addClass("btn-danger");

                socketCBOpenClose.emit("update-data", true);
            });

            $("#cb-open-close-btn-open").on("click", function () {
                $("#btn-cb-open").removeClass("btn-secondary");
                $("#btn-cb-open").addClass("btn-success");
                $("#btn-cb-close").removeClass("btn-danger");
                $("#btn-cb-close").addClass("btn-secondary");

                socketCBOpenClose.emit("update-data", false);
            });
            // end cb open close

            // start tap-changer
            let socketTapChanger = io(socketEndpoint + "/tap-changer");
            let valueTapChanger;

            socketTapChanger.on("connect", function () {
                socketTapChanger.emit("get-data");
            });

            socketTapChanger.on("disconnect", function () {
            });

            socketTapChanger.on("listen", function (data) {
                valueTapChanger = data;
                $("#number-display").text(valueTapChanger);
            });

            socketTapChanger.on("connect_error", function (error) {
            });

            $("#tap-changer-increase").on("click", function () {
                socketTapChanger.emit("update-data", 1);
            });
            $("#tap-changer-decrease").on("click", function () {
                socketTapChanger.emit("update-data", 2);
            });
            // end tap-changer

            // disable all button
            function disableAllButton(value) {
                if (value){
                    $("#cb-open-close-btn-open, #cb-open-close-btn-close").removeAttr("disabled").attr("disabled", true);
                } else {
                    $("#cb-open-close-btn-open, #cb-open-close-btn-close").removeAttr("disabled").attr("disablde", false);
                }
            }
        });

    </script>
</div>
